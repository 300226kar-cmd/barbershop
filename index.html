
<!DOCTYPE html>
<html lang="hy">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Panel</title>

<style>
body{font-family:Arial;background:#f5f5f5;padding:30px;}
input,select,button{padding:10px;border-radius:10px;border:1px solid #ccc;font-size:15px;}
button{border:none;cursor:pointer;}
#loginBtn,#refreshBtn,#addDateBtn,#addWeekdayBtn{background:black;color:white;margin-bottom:15px;}
table{width:100%;border-collapse:collapse;background:white;border-radius:12px;overflow:hidden;box-shadow:0 0 10px rgba(0,0,0,0.15);}
th,td{padding:12px;border-bottom:1px solid #ddd;text-align:left;}
th{background:black;color:white;}
tr:hover{background:#f0f0f0;}
.deleteBtn{background:rgb(255, 0, 89);color:rgb(245, 242, 242);border-radius:8px;padding:8px 12px;}
#adminPanel{display:none;margin-top:20px;}
#statusMsg{margin-top:10px;font-size:14px;}

.box{
    background:white;
    padding:20px;
    border-radius:15px;
    margin-bottom:20px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}

.closed-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#eee;
    padding:10px;
    border-radius:10px;
    margin-top:10px;
}
.removeBtn{
    background:red;
    color:white;
    padding:7px 12px;
    border-radius:8px;
}
@media (max-width: 800px){

  body{
    padding:15px;
  }

  h2{
    display: block;
    font-size:20px;
  }

  input,select,button{
    width:300px;
    font-size:16px;
    box-sizing:border-box;

  }
  button{
    width: 200px;
    margin-top:10px
  }
  

  table{
    width: auto;
    display:block;
    font-size:10px;
  }
 td{
  padding: 8px;
 }
  th{
    width: auto;
    padding: 5px;
  }

  .box{
    width: 350px;
    padding:15px;
  }
   .deleteBtn{
    width: 60px;
 
   }
  .closed-item{
    flex-direction:column;
    align-items:flex-start;
    gap:10px;
  }

  .removeBtn{
 
    width:100%;
  }
}
</style>
</head>

<body>

<h2>üîí Admin Login</h2>
<input type="password" id="passwordInput" placeholder="‘≥’°’≤’ø’∂’°’¢’°’º"/>
<button id="loginBtn">’Ñ’∏÷Ç’ø÷Ñ</button>
<p id="statusMsg"></p>

<div id="adminPanel">

  <div class="box">
    <h2>üìã ’ä’°’ø’æ’•÷Ä’∂’•÷Ä’´ ÷Å’∏÷Ç÷Å’°’Ø</h2>
    <button id="refreshBtn">üîÑ ‘π’°÷Ä’¥’°÷Å’∂’•’¨</button>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>‘±’∂’∏÷Ç’∂</th>
          <th>’Ä’•’º’°’≠’∏’Ω</th>
          <th>’ï÷Ä</th>
          <th>‘∫’°’¥</th>
          <th>‘≥’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂</th>
        </tr>
      </thead>
      <tbody id="bookingsBody"></tbody>
    </table>
  </div>

  <div class="box">
    <h2>üö´ ’â’°’∑’≠’°’ø’°’∂÷Ñ’°’µ’´’∂ ÷Ö÷Ä’•÷Ä</h2>

    <h3>üìå ’ì’°’Ø’•’¨ ’Ø’∏’∂’Ø÷Ä’•’ø ’°’¥’Ω’°’©’´’æ</h3>
    <input type="date" id="closedDateInput">
    <button id="addDateBtn">‚ûï ‘±’æ’•’¨’°÷Å’∂’•’¨</button>

    <h3>üìå ’ì’°’Ø’•’¨ ’∑’°’¢’°’©’æ’° ÷Ö÷Ä</h3>
    <select id="weekdaySelect">
      <option value="0">‘ø’´÷Ä’°’Ø’´</option>
      <option value="1">‘µ÷Ä’Ø’∏÷Ç’∑’°’¢’©’´</option>
      <option value="2">‘µ÷Ä’•÷Ñ’∑’°’¢’©’´</option>
      <option value="3">’â’∏÷Ä’•÷Ñ’∑’°’¢’©’´</option>
      <option value="4">’Ä’´’∂’£’∑’°’¢’©’´</option>
      <option value="5">’à÷Ç÷Ä’¢’°’©</option>
      <option value="6">’á’°’¢’°’©</option>
    </select>
    <button id="addWeekdayBtn">‚ûï ‘±’æ’•’¨’°÷Å’∂’•’¨</button>

    <h3>üìå ’ì’°’Ø ÷Ö÷Ä’•÷Ä’´ ÷Å’∏÷Ç÷Å’°’Ø</h3>
    <div id="closedList"></div>
  </div>

</div>

<script>
const API_URL="/api";

const passwordInput=document.getElementById("passwordInput");
const loginBtn=document.getElementById("loginBtn");
const statusMsg=document.getElementById("statusMsg");

const adminPanel=document.getElementById("adminPanel");
const refreshBtn=document.getElementById("refreshBtn");
const bookingsBody=document.getElementById("bookingsBody");

const closedDateInput=document.getElementById("closedDateInput");
const addDateBtn=document.getElementById("addDateBtn");

const weekdaySelect=document.getElementById("weekdaySelect");
const addWeekdayBtn=document.getElementById("addWeekdayBtn");

const closedList=document.getElementById("closedList");

let adminPassword="";

const weekdayNames={
  0:"‘ø’´÷Ä’°’Ø’´",
  1:"‘µ÷Ä’Ø’∏÷Ç’∑’°’¢’©’´",
  2:"‘µ÷Ä’•÷Ñ’∑’°’¢’©’´",
  3:"’â’∏÷Ä’•÷Ñ’∑’°’¢’©’´",
  4:"’Ä’´’∂’£’∑’°’¢’©’´",
  5:"’à÷Ç÷Ä’¢’°’©",
  6:"’á’°’¢’°’©"
};

loginBtn.onclick=async()=>{
  adminPassword=passwordInput.value.trim();
  if(!adminPassword){
    statusMsg.textContent="‚ùó ’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’•÷Ñ ’£’°’≤’ø’∂’°’¢’°’º";
    return;
  }

  const ok=await loadBookings();
  if(ok){
    adminPanel.style.display="block";
    statusMsg.textContent="‚úÖ ’Ñ’∏÷Ç’ø÷Ñ’® ’∞’°’ª’∏’≤ ’ß";
    passwordInput.value="";
    loadClosedDays();
  }
};

refreshBtn.onclick=loadBookings;

async function loadBookings(){
  statusMsg.textContent="‘≤’•’º’∂’æ’∏÷Ç’¥ ’ß...";
  try{
    const res=await fetch(`${API_URL}/all-bookings`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({password:adminPassword})
    });

    const data=await res.json();

    if(!res.ok){
      statusMsg.textContent="‚ùå "+data.message;
      return false;
    }

    bookingsBody.innerHTML="";

    if(!data.length){
      bookingsBody.innerHTML=`<tr><td colspan="6">’ä’°’ø’æ’•÷Ä’∂’•÷Ä ’π’Ø’°’∂</td></tr>`;
      statusMsg.textContent="üì≠ ’ä’°’ø’æ’•÷Ä’∂’•÷Ä ’π’Ø’°’∂";
      return true;
    }

    data.sort((a,b)=>new Date(a.date+" "+a.time)-new Date(b.date+" "+b.time));

    data.forEach(b=>{
      const row=document.createElement("tr");
      row.innerHTML=`
        <td>${b.id}</td>
        <td>${b.name}</td>
        <td>${b.phone}</td>
        <td>${b.date}</td>
        <td>${b.time}</td>
        <td><button class="deleteBtn" onclick="deleteBooking (${b.id})">"üóë ’ã’∂’ª’•’¨"</button></td>
      `;
      bookingsBody.appendChild(row);
    });

    statusMsg.textContent=`‚úÖ ‘≤’•’º’∂’æ’•÷Å (${data.length} ’∫’°’ø’æ’•÷Ä)`;
    return true;

  }catch(err){
    statusMsg.textContent="‚ùå ’ç’•÷Ä’æ’•÷Ä’´ ’Ω’≠’°’¨";
    return false;
  }
}

window.deleteBooking = async function(id){
  if(!confirm("’é’Ω’ø’°’û’∞ ’•÷Ñ, ’∏÷Ä ’∏÷Ç’¶’∏÷Ç’¥ ’•÷Ñ ’ª’∂’ª’•’¨ ’∫’°’ø’æ’•÷Ä’®")) return;

  try{
    const res=await fetch(`${API_URL}/delete-booking`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({password:adminPassword,id})
    });

    const data=await res.json();

    if(!res.ok){
      alert("‚ùå "+data.message);
      return;
    }

    alert("‚úÖ ’ä’°’ø’æ’•÷Ä’® ’ª’∂’ª’æ’•÷Å");
    loadBookings();

  }catch(err){
    alert("‚ùå ’ç’•÷Ä’æ’•÷Ä’´ ’Ω’≠’°’¨");
  }
};

// -------- CLOSED DAYS --------

async function loadClosedDays(){
  try{
    const res=await fetch(`${API_URL}/closed-days`);
    const data=await res.json();

    closedList.innerHTML="";

    // weekdays
    data.weekdays.forEach(day=>{
      const div=document.createElement("div");
      div.className="closed-item";
      div.innerHTML=`
        <span>üìÖ ’ì’°’Ø ÷Ö÷Ä (’∑’°’¢’°’©’æ’° ÷Ö÷Ä)’ù <b>${weekdayNames[day]}</b></span>
        <button class="removeBtn" onclick="removeClosedDay('weekday', ${day})">‚úñ</button>
      `;
      closedList.appendChild(div);
    });

    // dates
    data.dates.forEach(date=>{
      const div=document.createElement("div");
      div.className="closed-item";
      div.innerHTML=`
        <span>üìÖ ’ì’°’Ø ÷Ö÷Ä (’°’¥’Ω’°’©’´’æ)’ù <b>${date}</b></span>
        <button class="removeBtn" onclick="removeClosedDay('date', '${date}')">‚úñ</button>
      `;
      closedList.appendChild(div);
    });

    if(!data.weekdays.length && !data.dates.length){
      closedList.innerHTML="<p>’æ’∏’π ’°’∑’≠’°’ø’°’∂÷Ñ’°’µ’´’∂ ÷Ö÷Ä</p>";
    }

  }catch(err){
    closedList.innerHTML="<p>‚ùå ’â’∞’°’ª’∏’≤’æ’•÷Å ’¢’•’º’∂’•’¨ ÷É’°’Ø ÷Ö÷Ä’•÷Ä’®</p>";
  }
}

addDateBtn.onclick = async ()=>{
  const date = closedDateInput.value;
  if(!date){alert("‘∏’∂’ø÷Ä’•÷Ñ ’°’¥’Ω’°’©’´’æ"); return;}

  await fetch(`${API_URL}/add-closed-day`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({password:adminPassword,type:"date",value:date})
  });

  closedDateInput.value="";
  loadClosedDays();
};

addWeekdayBtn.onclick = async ()=>{
  const day = parseInt(weekdaySelect.value);

  await fetch(`${API_URL}/add-closed-day`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({password:adminPassword,type:"weekday",value:day})
  });

  loadClosedDays();
};

window.removeClosedDay = async function(type,value){
  await fetch(`${API_URL}/remove-closed-day`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({password:adminPassword,type,value})
  });

  loadClosedDays();
};

setInterval(()=>{
  if(adminPassword){
    loadBookings();
  }
},30000);

</script>

</body>

</html>
